(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{1329:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=_(r(0)),i=r(138),c=_(r(1)),l=r(19),s=_(r(32)),u=_(r(21)),d=_(r(154)),f=_(r(69)),p=r(115),h=_(r(15)),m=_(r(157)),v=r(215),E=_(r(309)),k=_(r(137)),b=r(1422),C=_(r(39)),g=_(r(43)),y=_(r(56));function _(e){return e&&e.__esModule?e:{default:e}}function w(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,a){try{var i=t[o](a),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}}r(1421);var L=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.isRepetitive=function(e){return/\b(\w)\1+\b/.test(e)};var n="";return r.props.isAuthenticated&&(n=r.props.user.email),r.state={imei:"",device:"",email:n,acceptedFirstTerm:!1,acceptedSecondTerm:!1,newsLetter:!1,formErrors:{imei:!1,device:!1,email:!1,captcha:!1},fetching:!1,captchaExecuted:!1},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default.Component),o(t,null,[{key:"vcConvertToProps",value:function(e){return{acceptTermsLink:e.link_url?e.link_url:{},requireAcceptTerms:e.require_accept_terms?e.require_accept_terms:"",requireSecondAcceptTerms:e.require_second_accept_terms?e.require_second_accept_terms:"",secondAcceptTermsLink:e.second_link_url?e.second_link_url:"",enableNewsletter:e.enable_newsletter_subscription||!1}}}]),o(t,[{key:"componentWillMount",value:function(){this.context.registerFetchAction((0,b.getListOfUnlockableDevices)())}},{key:"componentWillReceiveProps",value:function(e){(0,b.getListOfUnlockableDevices)()(e.dispatch,this.context.store.getState())}},{key:"isHexaNumber",value:function(e){return/^[-+]?[0-9A-Fa-f]+\.?[0-9A-Fa-f]*?$/.test(e)}},{key:"isCorrectLength",value:function(e){return!(e.length<14||e.length>16)}},{key:"validateForm",value:function(e,t,r){var n={error:!1,formErrors:{imei:!1,device:!1,email:!1,captcha:!1}};return e&&0!==e.length||(n.error=!0,n.formErrors.device=!0),t&&this.isCorrectLength(t)||(n.error=!0,n.formErrors.imei=!0),this.isHexaNumber(t)||(n.error=!0,n.formErrors.imei=!0),this.isRepetitive(t)&&(n.error=!0,n.formErrors.imei=!0),!(0,v.validateEmail)(r)&&this.state.newsLetter&&(n.error=!0,n.formErrors.email=!0),n}},{key:"handleDeviceChange",value:function(e){this.setState({device:e})}},{key:"handleInputChange",value:function(e){var t=e.target,r="checkbox"===t.type?t.checked:t.value,n=t.name;this.setState(function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},n,r))}},{key:"handleSubmit",value:function(){var e=w(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),this.captcha&&this.captcha.execute&&(this.captcha.execute(),this.setState({captchaExecuted:!0}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"validateAndGetUnlockCode",value:function(){var e=w(regeneratorRuntime.mark(function e(t){var r,n,o,a,i,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.state,n=r.device,o=r.imei,a=r.email,this.state.newsLetter||(a=""),i=this.validateForm(n,o,a),this.setState({captchaExecuted:!1}),!1!==i.error){e.next=10;break}return this.setState({fetching:!0}),e.next=8,(0,b.getUnlockCode)(n,o,a,t)(this.props.dispatch,this.context.store.getState());case 8:(c=e.sent)&&c.unlock_code&&(0,p.setDataLayer)({event:"unlockbootloader-request",device:n,newsletter:this.state.newsLetter});case 10:this.setState({formErrors:i.formErrors,fetching:!1});case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unlockableDevicesOptions",value:function(e){var t=[];return e.map(function(e,r){var n={value:e.slug,text:e.post_title};t[r]=n}),t.sort(function(e,t){return e.text.toLowerCase()>t.text.toLowerCase()?1:e.text.toLowerCase()<t.text.toLowerCase()?-1:0}),t}},{key:"formatReasonType",value:function(e){switch(e){case"invalid_imei":return this.context.localize("message-invalid-imei");case"captcha-not-verified":return this.context.localize("message-captcha-not-verified");default:return this.context.localize("message-unknown-error")}}},{key:"renderUnlockCodeErrorMessage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=null;return"string"==typeof e&&(t=this.formatReasonType(e)),a.default.createElement(k.default,{message:t||e.error_description||this.context.localize("message-unknown-error"),viewport:this.props.viewport})}},{key:"getAcceptTermsCheckboxes",value:function(){var e=[];return this.props.requireAcceptTerms&&e.push(a.default.createElement(m.default,{name:"acceptedFirstTerm",linkUrl:this.props.acceptTermsLink.url,linkText:this.props.acceptTermsLink.title,onCheck:this.handleInputChange.bind(this),key:"acceptedFirstTerm",styletype:"filled"})),this.props.requireSecondAcceptTerms&&e.push(a.default.createElement(m.default,{name:"acceptedSecondTerm",linkUrl:this.props.secondAcceptTermsLink.url,linkText:this.props.secondAcceptTermsLink.title,onCheck:this.handleInputChange.bind(this),key:"acceptedSecondTerm",styletype:"filled"})),e}},{key:"getNewsLetterInput",value:function(){return this.state.newsLetter?a.default.createElement(f.default,{id:"newsLetter",value:this.state.email,name:"email",type:"email",error:this.state.formErrors.email,style:{margin:"0 0 3rem 0",width:"250px"},placeholder:this.context.localize("input-label-email"),onChange:this.handleInputChange.bind(this),styletype:"light"}):null}},{key:"onCaptchaChange",value:function(e){this.state.captchaExecuted&&e&&this.validateAndGetUnlockCode(e)}},{key:"handleNewCodeClick",value:function(){delete this.props.unlockCodeList[this.state.imei],this.setState({imei:"",acceptedFirstTerm:!1,acceptedSecondTerm:!1})}},{key:"render",value:function(){var e=this,t=this.props,r=t.unlockableDevices,o=t.unlockCodeList,i=t.errorUnlockCode,c=t.loadingDeviceList,l=t.errorUnlockCodeReason,p=t.viewport,v=t.requireAcceptTerms,k=t.requireSecondAcceptTerms,b=t.enableNewsletter,_=this.state,w=_.device,L=_.imei,O=_.email,x=_.fetching,N=_.acceptedFirstTerm,U=_.acceptedSecondTerm;if(c)return a.default.createElement(u.default,{message:this.context.localize("message-unlock-loading-device-list")});var T;T=v&&k?this.validateForm(w,L,O).error||x||!N||!U:v?this.validateForm(w,L,O).error||x||!N:this.validateForm(w,L,O).error||x;var D=null;x&&(D=a.default.createElement(C.default,null,a.default.createElement(g.default,{width:"1/3",viewport:p}),a.default.createElement(g.default,{width:"2/3",viewport:p},a.default.createElement("div",{className:"unlock-bootloader--loading"},a.default.createElement("p",{className:"unlock-bootloader--loading--text"},this.context.localize("message-unlock-fetching-code"))))));var A=this.getNewsLetterInput(),S=this.getAcceptTermsCheckboxes(),R=this.context.localize("submit");i&&(R=this.context.localize("retry"));var B=null,I=null;if(this.state.device){var K=r.find(function(t){return t.slug===e.state.device});I=a.default.createElement("div",{className:"unlock-bootloader--instructions"},a.default.createElement(C.default,{paddingBottom:"1"},a.default.createElement(g.default,{width:"1/3",viewport:p},a.default.createElement("div",{className:"phone-unlock--image"},a.default.createElement(y.default,n({useNativeWidth:"true"},K.image)))),a.default.createElement(g.default,{width:"2/3",viewport:p},a.default.createElement("div",{className:"unlock-bootloader--guide",dangerouslySetInnerHTML:{__html:K.description}})))),B=a.default.createElement("div",{className:"unlock-bootloader--submit-form"},a.default.createElement(C.default,null,a.default.createElement(g.default,{width:"1/3",viewport:p}),a.default.createElement(g.default,{width:"2/3",viewport:p},a.default.createElement(f.default,{id:"1",value:this.state.imei,name:"imei",type:"text",error:!this.isCorrectLength(this.state.imei)||!this.isHexaNumber(this.state.imei),style:{margin:"1rem 0",width:"250px","font-size":"24px"},placeholder:this.context.localize("input-label-unlock-imei"),onChange:this.handleInputChange.bind(this),styletype:"light"}),S,b?a.default.createElement(m.default,{name:"newsLetter",label:this.context.localize("label-subscribe-to-newsletter"),style:{margin:"1rem 0"},onCheck:this.handleInputChange.bind(this),defaultChecked:!1,styletype:"filled"}):null,A,a.default.createElement("div",{className:"unlock-bootloader--form-group"},a.default.createElement(h.default,{onClick:this.handleSubmit.bind(this),name:"submit",size:"medium",disabled:T},R),a.default.createElement(E.default,{onCheck:this.onCaptchaChange.bind(this),siteKey:this.props.captchaKey,ref:function(t){e.captcha=t}})))))}var F=!1!==i?a.default.createElement("div",{className:"unlock-bootloader--unlock-code-error"},this.renderUnlockCodeErrorMessage(l)):null,j=void 0;!1===i&&o[L]&&(j=a.default.createElement("div",{className:"unlock-bootloader--unlock-code-response"},a.default.createElement("p",null,"Your unlock code for ",this.state.imei),a.default.createElement(s.default,{className:"unlock-bootloader--unlock-code-response--code",tag:2},o[L]),a.default.createElement("p",{className:"unlock-bootloader--unlock-code-response--new-code",onClick:this.handleNewCodeClick.bind(this)},"Generate new code")));var z=a.default.createElement("div",{className:"unlock-bootloader--form-group"},a.default.createElement(d.default,{value:this.state.device,name:"device",placeholder:this.context.localize("device"),label:this.context.localize("select-your-device"),ariaLabel:this.context.localize("select-your-device"),onChange:this.handleDeviceChange.bind(this),options:this.unlockableDevicesOptions(r),styletype:"filled"}));return a.default.createElement("div",{className:"unlock-bootloader"},a.default.createElement("form",{className:"unlock-bootloader--form",onSubmit:this.handleSubmit.bind(this)},z,I,o[L]&&!1===i?null:B,D),a.default.createElement("div",{className:"unlock-bootloader--unlock-code"},a.default.createElement(C.default,null,a.default.createElement(g.default,{width:"1/3",viewport:p}),a.default.createElement(g.default,{width:"2/3",viewport:p},j,F))))}}]),t}();L.propTypes={unlockableDevices:c.default.array,unlockCodeList:c.default.object,dispatch:c.default.func,errorDeviceList:c.default.oneOfType([c.default.bool,c.default.number]),errorUnlockCode:c.default.oneOfType([c.default.bool,c.default.number]),loadingDeviceList:c.default.bool,loadedDeviceList:c.default.bool,errorUnlockCodeReason:c.default.object,loadingUnlockCode:c.default.bool,isAuthenticated:c.default.bool,user:c.default.object,acceptTermsLink:c.default.object,captchaKey:c.default.string,requireAcceptTerms:c.default.oneOf(["yes",""]),requireSecondAcceptTerms:c.default.string,secondAcceptTermsLink:c.default.object,viewport:c.default.object,enableNewsletter:c.default.bool},L.contextTypes={store:c.default.object,registerFetchAction:c.default.func,localize:c.default.func};var O=(0,i.withRouter)((0,l.connect)(function(e){return{unlockableDevices:e.unlockBootloader.unlockableDevices,unlockCodeList:e.unlockBootloader.unlockCodeList,errorDeviceList:e.unlockBootloader.error,loadingDeviceList:e.unlockBootloader.loading,loadedDeviceList:e.unlockBootloader.loaded,errorUnlockCode:e.unlockBootloader.errorUnlockCode,errorUnlockCodeReason:e.unlockBootloader.errorUnlockCodeReason,loadingUnlockCode:e.unlockBootloader.loadingUnlockCode,isAuthenticated:e.user.isAuthenticated,user:e.user.details,captchaKey:e.settings.captchaKey,viewport:e.viewport}},function(e){return{dispatch:e}})(L));t.default=O},1421:function(e,t){},1422:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UNLOCKABLE_CODE_NOT_FOUND=t.RECEIVE_UNLOCKABLE_CODE=t.REQUEST_UNLOCKABLE_CODE=t.UNLOCKABLE_DEVICES_NOT_FOUND=t.RECEIVE_UNLOCKABLE_DEVICES=t.REQUEST_UNLOCKABLE_DEVICES=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.getListOfUnlockableDevices=function(){return e=a(regeneratorRuntime.mark(function e(t,r,n){var a,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,o.shouldFetch)(r.unlockBootloader)){e.next=17;break}return a=r.settings.apiUrl+"/unlock-bootloader/devices",t({type:i}),e.prev=3,e.next=6,(0,o.fetchResource)(a,n);case 6:return c=e.sent,t(f(c)),e.abrupt("return",Promise.resolve());case 11:return e.prev=11,e.t0=e.catch(3),t({type:l}),e.abrupt("return",e.t0);case 15:e.next=18;break;case 17:return e.abrupt("return",Promise.resolve());case 18:case"end":return e.stop()}},e,this,[[3,11]])})),function(t,r,n){return e.apply(this,arguments)};var e},t.getUnlockCode=function(e,t,r,n){return i=a(regeneratorRuntime.mark(function a(i,c){var l,s,u;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return l=c.settings.apiUrl+"/unlock-bootloader/unlock_requests_with_unlock_code",i(p(t)),a.prev=2,s={device:e,email:r,imei:t,captcha:n},a.next=6,(0,o.postResource)(l,s);case 6:return u=a.sent,i(h(t,u)),a.abrupt("return",u);case 11:return a.prev=11,a.t0=a.catch(2),i(m(t,a.t0)),a.abrupt("return",a.t0);case 15:case"end":return a.stop()}},a,this,[[2,11]])})),function(e,t){return i.apply(this,arguments)};var i};var o=r(24);function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,a){try{var i=t[o](a),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}}var i=t.REQUEST_UNLOCKABLE_DEVICES="REQUEST_UNLOCKABLE_DEVICES",c=t.RECEIVE_UNLOCKABLE_DEVICES="RECEIVE_UNLOCKABLE_DEVICES",l=t.UNLOCKABLE_DEVICES_NOT_FOUND="UNLOCKABLE_DEVICES_NOT_FOUND",s=t.REQUEST_UNLOCKABLE_CODE="REQUEST_UNLOCKABLE_CODE",u=t.RECEIVE_UNLOCKABLE_CODE="RECEIVE_UNLOCKABLE_CODE",d=t.UNLOCKABLE_CODE_NOT_FOUND="UNLOCKABLE_CODE_NOT_FOUND";function f(e){return{type:c,devices:e}}function p(e){return{type:s,imei:e}}function h(e,t){return{type:u,code:t.unlock_code,imei:e}}function m(e,t){return n({type:d,imei:e},t)}}}]);